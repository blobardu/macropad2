// ---------------------------
// libraries
// ---------------------------
#include <BleKeyboard.h>

// ---------------------------
// define pins/variables
// ---------------------------
#define BTN1_PIN 4                                 
#define BTN2_PIN 5
#define BTN3_PIN 6
#define BTN4_PIN 7
#define BTN5_PIN 8
#define BTN6_PIN 9
#define BTN7_PIN 3
#define BTN8_PIN 20
#define BTN9_PIN 21

int layer = 1;


// ---------------------------
// initialise keyboard/bluetooth
// ---------------------------
BleKeyboard blekb("BLE MacroPad","CH", 100);

// ---------------------------
// create function to detect button presses
// ---------------------------
int bp(uint8_t button) {
  static uint32_t lastStates = 0;
  uint8_t state = digitalRead(button);
  if (state != ((lastStates >> button) & 1)) {
    lastStates ^= 1 << button;
    return state == HIGH;
  }
  return false;
}

void setup() {                

// ---------------------------
// Set buttons as input 
// ---------------------------
  pinMode(BTN1_PIN, INPUT_PULLUP); 
  pinMode(BTN2_PIN, INPUT_PULLUP); 
  pinMode(BTN3_PIN, INPUT_PULLUP);
  pinMode(BTN4_PIN, INPUT_PULLUP);  
  pinMode(BTN5_PIN, INPUT_PULLUP);
  pinMode(BTN6_PIN, INPUT_PULLUP);
  pinMode(BTN7_PIN, INPUT_PULLUP);
  pinMode(BTN8_PIN, INPUT_PULLUP);
  pinMode(BTN9_PIN, INPUT_PULLUP);
  Serial.begin(9600);
  blekb.begin();// ---------------------------
// libraries
// ---------------------------
#include <BleKeyboard.h>

// ---------------------------
// define pins/variables
// ---------------------------
#define BTN1_PIN 4                                 
#define BTN2_PIN 5
#define BTN3_PIN 6
#define BTN4_PIN 7
#define BTN5_PIN 8
#define BTN6_PIN 9
#define BTN7_PIN 3
#define BTN8_PIN 20
#define BTN9_PIN 21

int layer = 1;


// ---------------------------
// initialise keyboard/bluetooth
// ---------------------------
BleKeyboard blekb("BLE MacroPad","CH", 100);

// ---------------------------
// create function to detect button presses
// ---------------------------
int bp(uint8_t button) {
  static uint32_t lastStates = 0;
  uint8_t state = digitalRead(button);
  if (state != ((lastStates >> button) & 1)) {
    lastStates ^= 1 << button;
    return state == HIGH;
  }
  return false;
}

void setup() {                

// ---------------------------
// Set buttons as input 
// ---------------------------
  pinMode(BTN1_PIN, INPUT_PULLUP); 
  pinMode(BTN2_PIN, INPUT_PULLUP); 
  pinMode(BTN3_PIN, INPUT_PULLUP);
  pinMode(BTN4_PIN, INPUT_PULLUP);  
  pinMode(BTN5_PIN, INPUT_PULLUP);
  pinMode(BTN6_PIN, INPUT_PULLUP);
  pinMode(BTN7_PIN, INPUT_PULLUP);
  pinMode(BTN8_PIN, INPUT_PULLUP);
  pinMode(BTN9_PIN, INPUT_PULLUP);
  Serial.begin(9600);
  blekb.begin();
  
}

void loop() {

// ---------------------------
// btn5(middle button) changes layers(1-3)
// ---------------------------
if(bp(BTN5_PIN)){
  if( layer < 3){
    layer++;
  }
  else{
    layer = 1;
  }
    Serial.print("layer: ");
    Serial.println(layer);
}

// ---------------------------
// make all buttons do an output(gone for now)
// ---------------------------
  // if(bp(BTN1_PIN)) {Serial.println("Button 1 pressed!");blekb.print("hello"); }
  // if(bp(BTN2_PIN)) {Serial.println("Button 2 pressed!");blekb.write(KEY_PAGE_UP); }
  // if(bp(BTN3_PIN)) {Serial.println("Button 3 pressed!"); }
  // if(bp(BTN4_PIN)) {Serial.println("button 4 pressed!"); }   //broken
  // if(bp(BTN5_PIN)) {Serial.println("Button 5 pressed!"); }
  // if(bp(BTN6_PIN)) {Serial.println("Button 6 pressed!"); }
  // if(bp(BTN7_PIN)) {Serial.println("Button 7 pressed!"); }
  // if(bp(BTN8_PIN)) {Serial.println("Button 8 pressed!"); } 
  // if(bp(BTN9_PIN)) {Serial.println("Button 9 pressed!"); }
  delay(100);
}
  
}

void loop() {

// ---------------------------
// btn5(middle button) changes layers(1-3)
// ---------------------------
if(bp(BTN5_PIN)){
  if( layer < 3){
    layer++;
  }
  else{
    layer = 1;
  }
    Serial.print("layer: ");
    Serial.println(layer);
}

// ---------------------------
// make all buttons do an output(gone for now)
// ---------------------------
  // if(bp(BTN1_PIN)) {Serial.println("Button 1 pressed!");blekb.print("hello"); }
  // if(bp(BTN2_PIN)) {Serial.println("Button 2 pressed!");blekb.write(KEY_PAGE_UP); }
  // if(bp(BTN3_PIN)) {Serial.println("Button 3 pressed!"); }
  // if(bp(BTN4_PIN)) {Serial.println("button 4 pressed!"); }   //broken
  // if(bp(BTN5_PIN)) {Serial.println("Button 5 pressed!"); }
  // if(bp(BTN6_PIN)) {Serial.println("Button 6 pressed!"); }
  // if(bp(BTN7_PIN)) {Serial.println("Button 7 pressed!"); }
  // if(bp(BTN8_PIN)) {Serial.println("Button 8 pressed!"); } 
  // if(bp(BTN9_PIN)) {Serial.println("Button 9 pressed!"); }
  delay(100);
}
